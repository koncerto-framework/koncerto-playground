<!DOCTYPE html>
<html>

<head>
    [onload;file=_layout.tbs.html;getpart=head]
</head>

<body data-controller="playground" data-proxy="https://cdn.jsdelivr.net/gh/koncerto-framework/koncerto-playground@latest/%s">
    [onload;file=_layout.tbs.html;getpart=(header)]
    <section data-impulsus="false" class="section" style="padding-top: 100px; box-sizing: border-box; height: 100vh;">
        <div class="columns is-mobile" style="height: 100%;">
            <div class="column is-narrow">
                <nav class="panel is-primary">
                    <p class="panel-heading">New project</p>
                    <div class="panel-block">
                        <aside class="menu">
                            [files;block=begin;sub1]
                            <p data-directory="[files.$]" data-target="directory" class="menu-label">[files.$]</p>
                            <ul data-parent="[files.$]" class="menu-list">
                                <li>
                                        <a href="#?[files.$]/[files_sub1.val;block=li]"
                                        onclick="window.loadFile('[files.$;strconv=js]/[files_sub1.val;strconv=js]');">
                                            [files_sub1.val]
                                        </a>
                                </li>
                            </ul>
                            [files;block=end]
                        </aside>
                    </div>
                </nav>
            </div>
            <div id="container" class="column">
                <script data-reload onload="if (window.reloadScript) reloadScript('#editor-script')" src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/loader.min.js"></script>
                <script id="editor-script">
                // require is provided by loader.min.js.
                require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs' }});
                require(["vs/editor/editor.main"], () => {
                    window.editor = monaco.editor.create(document.getElementById('container'), {
                        value: '',
                        language: 'php'
                    });

                    function getHtmlCompletionProvider(monaco) {
                        return {
                            provideCompletionItems: function (model, position) {
                                window.saveFile();
                                return { suggestions: [] };
                            }
                        };
                    }

                    function getPhpCompletionProvider(monaco) {
                        var comments = ['internal', 'param', 'return'];
                        return {
                            triggerCharacters: ['@', ' ', '{'],
                            provideCompletionItems: function (model, position) {
                                window.saveFile();
                                var text = model.getValueInRange({startLineNumber: 1, startColumn: 1, endLineNumber: position.lineNumber, endColumn: position.column});
                                var suggestions = [];
                                var keyword = text.split(' ').pop();
                                comments.forEach(function (comment) {
                                    if ('' !== keyword.trim() && `@${comment}`.startsWith(keyword)) {
                                        suggestions.push({
                                            label: `@${comment}`,
                                            filterText: comment,
                                            kind: monaco.languages.CompletionItemKind.Keyword,
                                            insertText: comment
                                        });
                                    }
                                });
                                suggestions.push({
                                    label: '{"route"}',
                                    filterText: '{"route"',
                                    kind: monaco.languages.CompletionItemKind.Keyword,
                                    insertText: '{"route": {"name": "${1}"}}',
                                    insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet
                                });
                                suggestions.push({
                                    label: 'KoncertoReponse',
                                    kind: monaco.languages.CompletionItemKind.Class,
                                    insertText: 'KoncertoResponse'
                                });
                                if (text.endsWith(' extends')) {
                                    suggestions.push({
                                        label: 'KoncertoController',
                                        filterText: ' extends',
                                        kind: monaco.languages.CompletionItemKind.Class,
                                        insertText: 'extends KoncertoController\n{\n\t${1}\n}',
                                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet
                                    });
                                }
                                if (suggestions.length > 0) {
                                    console.debug(suggestions);
                                }
                                return { suggestions };
                            }
                        };
                    }

                    monaco.languages.registerCompletionItemProvider('php', getPhpCompletionProvider(monaco));
                    monaco.languages.registerCompletionItemProvider('html', getHtmlCompletionProvider(monaco));
                });

                document.querySelectorAll('.navbar-dropdown a').forEach(function (a) {
                    a.addEventListener('click', function() {
                        a.parentNode.style.display = 'none';
                        setTimeout(function() {
                            a.parentNode.style.display = '';
                            a.blur();
                        }, 100);
                    })
                });
                </script>
            </div>
        </div>
        <div id="modal-new-project" class="modal">
            <div class="modal-background"></div>
            <div class="modal-card">
                <header class="modal-card-head">
                    <p class="modal-card-title">New project</p>
                    <button class="delete" aria-label="close" data-action="click->playground#closeModal"></button>
                </header>
                <section class="modal-card-body">
                    <input id="new-project-name" class="input" type="text" placeholder="Project name" />
                </section>
                <footer class="modal-card-foot">
                    <div class="buttons">
                        <button class="button is-success" data-action="click->playground#newProjectConfirm">Save &amp; open</button>
                        <button class="button" data-action="click->playground#closeModal">Cancel</button>
                    </div>
                </footer>
            </div>
        </div>
        <div id="modal-open-project" class="modal">
            <div class="modal-background"></div>
            <div class="modal-card">
                <header class="modal-card-head">
                    <p class="modal-card-title">Open project</p>
                    <button class="delete" aria-label="close" data-action="click->playground#closeModal"></button>
                </header>
                <section class="modal-card-body">
                    <div class="select is-multiple is-fullwidth">
                        <select id="open-project-name" size="5" class="is-fullwidth" style="min-height: 20vh;">
                        </select>
                    </div>
                </section>
                <footer class="modal-card-foot">
                    <div class="buttons">
                        <button class="button is-success" data-action="click->playground#openProjectConfirm">Open</button>
                        <button class="button" data-action="click->playground#closeModal">Cancel</button>
                    </div>
                </footer>
            </div>
        </div>
        <div id="modal-new-folder" class="modal">
            <div class="modal-background"></div>
            <div class="modal-card">
                <header class="modal-card-head">
                    <p class="modal-card-title">New folder</p>
                    <button class="delete" aria-label="close" data-action="click->playground#closeModal"></button>
                </header>
                <section class="modal-card-body">
                    <input id="new-folder-name" class="input" type="text" placeholder="Folder name" />
                </section>
                <footer class="modal-card-foot">
                    <div class="buttons">
                        <button class="button is-success" data-action="click->playground#newFolderConfirm">Save &amp; open</button>
                        <button class="button" data-action="click->playground#closeModal">Cancel</button>
                    </div>
                </footer>
            </div>
        </div>
        <div id="modal-new-file" class="modal">
            <div class="modal-background"></div>
            <div class="modal-card">
                <header class="modal-card-head">
                    <p class="modal-card-title">New file</p>
                    <button class="delete" aria-label="close" data-action="click->playground#closeModal"></button>
                </header>
                <section class="modal-card-body">
                    <input id="new-file-name" class="input" type="text" placeholder="File name" />
                </section>
                <footer class="modal-card-foot">
                    <div class="buttons">
                        <button class="button is-success" data-action="click->playground#newFileConfirm">Save &amp; open</button>
                        <button class="button" data-action="click->playground#closeModal">Cancel</button>
                    </div>
                </footer>
            </div>
        </div>
    </section>
</body>

</html>